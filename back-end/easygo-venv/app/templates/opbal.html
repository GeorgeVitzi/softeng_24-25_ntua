{% extends 'base.html' %}

{% block content %}
<link rel="stylesheet" href="/static/styles_welcome_operator.css">

<!-- Navigation Bar -->
<div class="navbar">
    <div class="nav-items">
        <a href="{{ url_for('welcome_operator') }}">Welcome</a>
        <a href="{{url_for('opbal')}}">Balance</a>
        <a href="{{url_for('stat')}}">Statistics</a>
        <a href="{{ url_for('partners_op') }}">Our Partners</a>
        <a href="{{ url_for('account_op') }}">My Account</a>
    </div>
    <a href="{{ url_for('logout') }}" class="logout-button">Logout</a>
</div>

<div class="balance-container">
    <h2>Balance Information</h2>
    <p>Select an operator and specify a date range:</p>

    <!-- Form to submit the data -->
    <form action="/opbal" method="post">
        <label for="operator">Select Operator:</label>
        <select name="opid" id="operator" required>
            <option value="" disabled selected>-- Select an Operator --</option>
            {% for operator in operators %}
                <option value="{{ operator['OpID'] }}">{{ operator['BrandName'] }}</option>
            {% endfor %}
        </select>
        <br><br>

        <label for="startdate">Start Date:</label>
        <input type="date" id="startdate" name="startdate" required>
        <br><br>

        <label for="enddate">End Date:</label>
        <input type="date" id="enddate" name="enddate" required>
        <br><br>

        <button type="submit">Submit</button>
    </form>
   
    {% if balance_data %}
    <h3>Results:</h3>
    <p>Your debts: {{ balance_data['user_total'] }} EUR</p>
    <p>Selected Operator debts: {{ balance_data['operator_total'] }} EUR</p>
    <p><strong>{{ balance_data['message'] }}: {{ balance_data['difference'] | abs }} EUR</strong></p>

    <h4>Your Charges:</h4>
    <table>
        <tr>
            <th>Toll ID</th>
            <th>Charge (EUR)</th>
            <th>Timestamp</th>
            <th>Tag</th>
        </tr>
        {% for record in balance_data['user_charges_records'] %}
        <tr>
            <td>{{ record['tollid'] }}</td>
            <td>{{ record['charge'] }}</td>
            <td>{{ record['timestamp'] }}</td>
            <td>{{ record['tagref'] }}</td>
        </tr>
        {% endfor %}
    </table>

    <h4>Operator's Charges:</h4>
    <table>
        <tr>
            <th>Toll ID</th>
            <th>Charge (EUR)</th>
            <th>Timestamp</th>
            <th>Tag</th>

        </tr>
        {% for record in balance_data['operator_charges_records'] %}
        <tr>
            <td>{{ record['tollid'] }}</td>
            <td>{{ record['charge'] }}</td>
            <td>{{ record['timestamp'] }}</td>
            <td>{{ record['tagref'] }}</td>
        </tr>
        {% endfor %}
    </table>

    {% if balance_data['user_total'] > balance_data['operator_total'] %}
        <div class="pay-debt-container">
            <form action="/opbal" method="post">
                <input type="hidden" name="opid" value="{{ request.form.get('opid') }}">
                <input type="hidden" name="startdate" value="{{ request.form.get('startdate') }}">
                <input type="hidden" name="enddate" value="{{ request.form.get('enddate') }}">
                <button type="submit" name="submit_debt" class="pay-debt-button">Pay your debt</button>
            </form>
        </div>
    {% endif %}
{% endif %}


{% if payment_processed %}
    <div id="paymentConfirmationMessage">
        <p>Your request has been processed successfully.</p>
    </div>
{% endif %}


<!-- Footer Container -->
<div class="footer-container">
    <div class="footer-left">Â© 2024 EasyGo</div>
    <div class="footer-center">Contact: info@easygo.gr or 2104242424</div>
    <div class="footer-right">Developed by Softeng 24-2</div>
</div>
{% endblock %}
